<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nexus Tiranga: Elite Edition</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #050505;
            --card-bg: #111111;
            --saffron: #FF9933;
            --white: #FFFFFF;
            --green: #138808;
            --blue: #000080;
            --army: #4B5320;
            --navy: #000080;
            --airforce: #5D8AA8;
        }

        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background-color: var(--bg-color);
            margin: 0; display: flex; justify-content: center; align-items: center;
            height: 100vh; overflow: hidden; color: white;
        }

        /* --- LOADER --- */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color); display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 10000;
            transition: 0.8s;
        }

        .loader-chakra {
            width: 80px; height: 80px;
            border: 2px solid var(--blue); border-radius: 50%;
            animation: spin 3s linear infinite; position: relative;
        }

        .loader-chakra::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: repeating-conic-gradient(transparent 0deg 14deg, var(--blue) 14deg 15deg);
            border-radius: 50%;
        }

        /* --- FORCE SELECTION --- */
        #force-selection {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.98); z-index: 999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        .force-card {
            width: 85%; max-width: 300px; padding: 20px; margin: 10px 0;
            border-radius: 15px; cursor: pointer; text-align: center;
            font-weight: 900; transition: 0.3s; border: 2px solid transparent;
            letter-spacing: 1px;
        }
        .army-card { background: var(--army); border-color: #6B8E23; }
        .navy-card { background: var(--navy); border-color: #4169E1; }
        .airforce-card { background: var(--airforce); border-color: #B0C4DE; }

        /* --- MAIN DASHBOARD --- */
        .neon-card {
            position: relative; width: 310px; padding: 40px 20px;
            background: var(--card-bg); border-radius: 24px; text-align: center;
        }

        .neon-card::before {
            content: ''; position: absolute; top: -3px; left: -3px; right: -3px; bottom: -3px;
            background: linear-gradient(45deg, var(--saffron), var(--white), var(--green));
            background-size: 400%; z-index: -1; border-radius: 27px; animation: flag-flow 8s linear infinite; filter: blur(12px);
        }

        #rank-badge {
            display: inline-block; padding: 4px 12px; border-radius: 50px;
            font-size: 0.7rem; font-weight: bold; margin-bottom: 10px;
            border: 1px solid #87CEEB; color: #87CEEB; text-transform: uppercase;
        }

        #user-photo {
            width: 90px; height: 90px; border-radius: 50%;
            border: 3px solid white; margin: 10px 0; object-fit: cover;
        }

        .btn { width: 100%; padding: 16px; border-radius: 14px; font-weight: 900; cursor: pointer; border: none; margin-top: 15px; }
        .confirm-btn { background: linear-gradient(90deg, var(--saffron), var(--white), var(--green)); color: black; }

        select { width: 85%; padding: 12px; margin-top: 15px; background: #222; color: white; border-radius: 10px; border: 1px solid #444; }

        /* --- ANIMATIONS --- */
        @keyframes flag-flow { 0% { background-position: 0% 50%; } 100% { background-position: 400% 50%; } }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* Audio Toggle */
        .audio-toggle {
            position: absolute; top: 20px; right: 20px; width: 40px; height: 40px;
            background: var(--card-bg); border: 1px solid var(--white); border-radius: 50%;
            display: flex; justify-content: center; align-items: center; cursor: pointer; z-index: 100;
        }
    </style>
</head>
<body>

    <audio id="bg-music" loop>
        <source src="vande_mataram.mp3" type="audio/mpeg">
    </audio>

    <div class="audio-toggle" id="audioToggle">
        <span id="audioIcon">üîá</span>
    </div>

    <div id="loader">
        <div class="loader-chakra"></div>
        <p style="margin-top:20px; letter-spacing:3px; font-size: 0.8rem;">LOADING DEFENCE CORE...</p>
    </div>

    <div id="force-selection">
        <h2 style="letter-spacing: 2px;">SELECT BRANCH</h2>
        <div class="force-card army-card" onclick="showUnits('Army')">‚öîÔ∏è INDIAN ARMY</div>
        <div class="force-card navy-card" onclick="showUnits('Navy')">‚öì INDIAN NAVY</div>
        <div class="force-card airforce-card" onclick="showUnits('AirForce')">ü¶Ö INDIAN AIR FORCE</div>

        <div id="unit-box" style="display:none; width:100%; text-align:center;">
            <select id="unit-select"></select>
            <button class="btn confirm-btn" style="width: 85%;" onclick="applyBadge()">REPORT TO COMMAND</button>
        </div>
    </div>

    <div class="neon-card" id="dashboard" style="display:none;">
        <div id="rank-badge">LIEUTENANT</div>
        <h3 id="unit-title" style="margin: 0; color: var(--saffron); font-size: 0.75rem;">UNIT</h3>
        
        <div style="position: relative; width: 110px; height: 110px; margin: 10px auto;">
            <div class="loader-chakra" style="position: absolute; width: 100%; height: 100%; opacity: 0.2;"></div>
            <img id="user-photo" src="" alt="Officer">
        </div>

        <h2 id="user-name" style="margin: 0;">OFFICER</h2>
        <p id="stats-text" style="font-size: 0.7rem; color: #888; margin-top: 5px;">SERVICE RECORD: 1 SESSION</p>
        
        <button class="btn confirm-btn" onclick="finish()">JAI HIND</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready(); tg.expand();

        const data = {
            Army: { units: ['Para SF', 'Gorkha Rifles', 'Sikh Regt', 'Rajputana Rifles'], color: '#4B5320' },
            Navy: { units: ['MARCOS', 'Naval Aviators', 'Submarine Arm', 'Fleet Command'], color: '#000080' },
            AirForce: { units: ['Garud Commando', 'Fighter Wing', 'Skylords', 'Air Logistics'], color: '#5D8AA8' }
        };

        let currentForce = "";

        // Loader
        window.onload = () => {
            setTimeout(() => {
                document.getElementById('loader').style.opacity = '0';
                setTimeout(() => { document.getElementById('loader').style.display = 'none'; }, 800);
            }, 1800);
        };

        // Rank Progression Logic
        function updateRank(sessions) {
            let rank = { title: "LIEUTENANT", color: "#87CEEB" };
            if (sessions >= 15) rank = { title: "FIELD MARSHAL", color: "#FF4500" };
            else if (sessions >= 10) rank = { title: "GENERAL", color: "#FFD700" };
            else if (sessions >= 6) rank = { title: "MAJOR", color: "#C0C0C0" };
            else if (sessions >= 3) rank = { title: "CAPTAIN", color: "#CD7F32" };
            
            const badge = document.getElementById('rank-badge');
            badge.innerText = rank.title;
            badge.style.color = rank.color;
            badge.style.borderColor = rank.color;
        }

        function showUnits(force) {
            currentForce = force;
            const select = document.getElementById('unit-select');
            select.innerHTML = "";
            data[force].units.forEach(u => {
                let opt = document.createElement('option');
                opt.value = u; opt.innerText = u;
                select.appendChild(opt);
            });
            document.getElementById('unit-box').style.display = 'block';
            tg.HapticFeedback.impactOccurred('medium');
        }

        function applyBadge() {
            const unit = document.getElementById('unit-select').value;
            document.getElementById('force-selection').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            
            // Sessions Logic
            let sessions = parseInt(localStorage.getItem('service_record') || "0") + 1;
            updateRank(sessions);

            document.getElementById('unit-title').innerText = unit.toUpperCase();
            document.getElementById('stats-text').innerText = `SERVICE RECORD: ${sessions} SESSIONS`;
            
            tg.HapticFeedback.notificationOccurred('success');
        }

        // Audio Logic
        const audio = document.getElementById('bg-music');
        const audioBtn = document.getElementById('audioToggle');
        let isPlaying = false;

        audioBtn.onclick = () => {
            if (!isPlaying) {
                audio.play().catch(() => {});
                document.getElementById('audioIcon').innerText = "üîä";
            } else {
                audio.pause();
                document.getElementById('audioIcon').innerText = "üîá";
            }
            isPlaying = !isPlaying;
            tg.HapticFeedback.impactOccurred('light');
        };

        // Load User Info
        const user = tg.initDataUnsafe?.user;
        if (user) {
            document.getElementById('user-name').innerText = user.first_name.toUpperCase();
            document.getElementById('user-photo').src = user.photo_url || `https://ui-avatars.com/api/?name=${user.first_name}&background=FF9933&color=fff`;
        }

        function finish() {
            let sessions = parseInt(localStorage.getItem('service_record') || "0") + 1;
            localStorage.setItem('service_record', sessions);
            
            const rank = document.getElementById('rank-badge').innerText;
            tg.sendData(`Officer ${user?.first_name || 'User'} (${rank}) - Mission Accomplished.`);
            tg.close();
        }
    </script>
</body>
</html>
