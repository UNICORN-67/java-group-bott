<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE SYSTEM - Hunter PvP</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { 
            --blue: #00d2ff; 
            --red: #ff4444; 
            --bg: #02020b; 
            --gold: #ffcc00; 
            --panel: rgba(0, 15, 40, 0.9);
        }

        body { 
            background: var(--bg); 
            color: white; 
            font-family: 'Segoe UI', sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            margin: 0; 
            padding: 0;
            overflow-x: hidden;
        }

        /* Top System Message */
        #system-broadcast {
            width: 100%;
            background: rgba(0, 210, 255, 0.15);
            border-bottom: 1px solid var(--blue);
            padding: 12px;
            text-align: center;
            font-weight: bold;
            font-size: 0.85rem;
            color: var(--gold);
            text-transform: uppercase;
            letter-spacing: 1px;
            min-height: 20px;
        }

        /* Main Profile Card */
        .hunter-ui {
            width: 90%;
            max-width: 380px;
            background: var(--panel);
            border: 2px solid var(--blue);
            box-shadow: 0 0 20px rgba(0, 210, 255, 0.3);
            padding: 25px;
            margin-top: 20px;
            border-radius: 5px;
            position: relative;
        }

        .rank-display {
            font-size: 3.5rem;
            font-weight: 900;
            text-align: center;
            margin: 0;
            line-height: 1;
            letter-spacing: -2px;
        }

        .stat-grid {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            border-top: 1px solid rgba(0, 210, 255, 0.2);
            padding-top: 15px;
        }

        .stat-box { text-align: center; }
        .stat-box b { font-size: 1.5rem; color: var(--blue); }

        /* Buttons */
        button {
            background: transparent;
            color: var(--blue);
            border: 1px solid var(--blue);
            padding: 12px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            width: 100%;
            transition: 0.3s;
        }

        button:hover { background: var(--blue); color: black; }

        /* Leaderboard */
        .active-list {
            width: 90%;
            max-width: 380px;
            margin-top: 25px;
        }

        .player-row {
            background: rgba(255,255,255,0.03);
            border-left: 3px solid var(--blue);
            margin-bottom: 8px;
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .atk-btn {
            border-color: var(--red);
            color: var(--red);
            padding: 5px 12px;
            width: auto;
            font-size: 0.7rem;
        }

        .atk-btn:hover { background: var(--red); color: white; }

        .loading { opacity: 0.5; pointer-events: none; }
    </style>
</head>
<body>

    <div id="system-broadcast">Connecting to the System...</div>

    <div class="hunter-ui">
        <h1 id="rank" class="rank-display">RANK E</h1>
        <p id="my-id" style="text-align: center; opacity: 0.6; margin: 5px 0;">HUNTER ID: ---</p>

        <div class="stat-grid">
            <div class="stat-box">LVL<br><b id="lvl">1</b></div>
            <div class="stat-box">STR<br><b id="str">10</b></div>
        </div>

        <button id="train-btn" onclick="train()">Daily Quest: Push-ups (+5 STR)</button>
    </div>

    <div class="active-list">
        <h3 style="color: var(--blue); border-bottom: 1px solid var(--blue); padding-bottom: 5px;">ACTIVE TARGETS</h3>
        <div id="player-list">
            </div>
    </div>

    <script>
        // 1. SUPABASE CONFIG (Step 4 se apni keys yahan dalein)
        const URL = 'https://jdqkfjwijcpdnssmniov.supabase.co';
        const KEY = 'jdqkfjwijcpdnssmniov';
        const supabase = supabase.createClient(URL, KEY);

        // 2. PLAYER IDENTITY
        let myId = localStorage.getItem('hunter_id') || "HUNTER-" + Math.floor(Math.random()*8999+1000);
        localStorage.setItem('hunter_id', myId);

        let myData = { id: myId, str: 10, lvl: 1, msg: "" };

        async function startSystem() {
            // Check if player exists in DB
            let { data } = await supabase.from('hunters').select().eq('id', myId).single();
            
            if (data) {
                myData = data;
            } else {
                await supabase.from('hunters').insert([myData]);
            }

            updateUI();
            fetchPlayers();

            // Realtime Updates: Jab koi bhi player update ho
            supabase.channel('system_changes')
            .on('postgres_changes', { event: '*', schema: 'public', table: 'hunters' }, (payload) => {
                fetchPlayers();
                if(payload.new && payload.new.msg) {
                    showBroadcast(payload.new.msg);
                }
            })
            .subscribe();
        }

        // 3. ACTIONS
        async function train() {
            const btn = document.getElementById('train-btn');
            btn.classList.add('loading');
            
            myData.str += 5;
            myData.lvl = Math.floor(myData.str / 10);
            
            await supabase.from('hunters').update({ str: myData.str, lvl: myData.lvl }).eq('id', myId);
            
            updateUI();
            btn.classList.remove('loading');
        }

        async function attack(targetId, targetStr) {
            if (myData.str > targetStr) {
                // Victory
                myData.str += 10;
                myData.lvl = Math.floor(myData.str / 10);
                const victoryMsg = `SYSTEM: ${myId} has ELIMINATED ${targetId}!`;
                
                await supabase.from('hunters').update({ 
                    str: myData.str, 
                    lvl: myData.lvl, 
                    msg: victoryMsg 
                }).eq('id', myId);
                
                showBroadcast("VICTORY! Target defeated.");
            } else {
                // Defeat
                showBroadcast("DEFEAT! You were too weak.");
            }
            updateUI();
        }

        // 4. UI HELPERS
        async function fetchPlayers() {
            const { data } = await supabase.from('hunters').select().neq('id', myId).order('str', { ascending: false }).limit(10);
            const list = document.getElementById('player-list');
            list.innerHTML = data.length ? "" : "<p style='opacity:0.5'>No other hunters online...</p>";
            
            data.forEach(p => {
                list.innerHTML += `
                    <div class="player-row">
                        <div><b>${p.id}</b><br><small>STR: ${p.str} | LVL: ${p.lvl}</small></div>
                        <button class="atk-btn" onclick="attack('${p.id}', ${p.str})">ATTACK</button>
                    </div>`;
            });
        }

        function updateUI() {
            document.getElementById('my-id').innerText = "HUNTER ID: " + myId;
            document.getElementById('str').innerText = myData.str;
            document.getElementById('lvl').innerText = myData.lvl;
            
            let rank = "E";
            if (myData.lvl >= 80) rank = "S";
            else if (myData.lvl >= 50) rank = "A";
            else if (myData.lvl >= 30) rank = "B";
            else if (myData.lvl >= 15) rank = "C";
            else if (myData.lvl >= 5) rank = "D";

            const rEl = document.getElementById('rank');
            rEl.innerText = "RANK " + rank;
            rEl.style.color = (rank === "S") ? "var(--gold)" : "white";
        }

        function showBroadcast(text) {
            const bar = document.getElementById('system-broadcast');
            bar.innerText = text;
            bar.style.background = "rgba(255, 204, 0, 0.2)";
            setTimeout(() => { bar.style.background = "rgba(0, 210, 255, 0.15)"; }, 4000);
        }

        startSystem();
    </script>
</body>
</html>


